window.App=Ember.Application.create({host:"http://192.168.1.21:8083",devices:null}),App.Clock=Ember.Object.extend({second:null,minute:null,hour:null,init:function(){this.tick()},tick:function(){var a=new Date,b=this;this.setProperties({second:a.getSeconds(),minute:a.getMinutes(),hour:a.getHours()}),setTimeout(function(){b.tick()},1e3)}}),Ember.Application.initializer({name:"clock",initialize:function(a){a.optionsForType("clock",{singleton:!0}),a.register("clock:main",App.Clock),a.typeInjection("controller","clock","clock:main")}}),Ember.ControllerMixin.reopen({clock:null}),Ember.Application.initializer({name:"devicepoller",initialize:function(a){var b=a.lookup("store:main"),c=App.DevicePoller.create({store:b});c.start()}}),App.DevicePoller=Ember.Object.extend({timer:null,store:null,since:null,interval:function(){return 1e3}.property().readOnly(),schedule:function(a){return Ember.run.later(this,function(){a.apply(this),this.set("timer",this.schedule(a))},this.get("interval"))},stop:function(){Ember.run.cancel(this.get("timer"))},start:function(){this.set("timer",this.schedule(this.get("onPoll")))},isRunning:function(){return!Ember.isEmpty(this.get("timer"))},onPoll:function(){var a=this,b=a.get("store"),c=moment().unix(),d=App.get("host"),e="/ZAutomation/api/v1/devices?limit=0",f=null,g=b.all("device"),h=null;f=d+e,Ember.isEmpty(a.get("since"))||(f+="&since="+a.get("since")),Ember.$.getJSON(f).then(function(d){a.set("since",c),200===d.code&&d.data.devices.forEach(function(a){h=g.filterBy("deviceId",a.id),Ember.isEmpty(h)?b.createRecord("device",{deviceType:a.deviceType,deviceId:a.id,location:a.location,level:a.metrics.level,title:a.metrics.title}):h.set("level",a.metrics.level)})})}}),App.Router.map(function(){}),App.ApplicationRoute=Ember.Route.extend({model:function(){var a=this.get("store").all("device");return App.set("devices",a),a}}),App.Device=DS.Model.extend({deviceType:DS.attr("string"),deviceId:DS.attr("string"),location:DS.attr("string"),level:DS.attr("string"),title:DS.attr("string"),isBinarySwitch:function(){return"switchBinary"===this.get("deviceType")}.property("deviceType"),isMultilevelSwitch:function(){return"switchMultilevel"===this.get("deviceType")}.property("deviceType")}),App.ApplicationController=Ember.Controller.extend({}),App.DeviceItemController=Ember.ObjectController.extend({binaryLevel:function(){var a=this.get("model");return"off"===a.get("level")?!1:!0}.property("clock.second"),actions:{setLevel:function(){var a=this.get("model"),b=App.get("host"),c="/ZAutomation/api/v1/devices/"+a.get("deviceId")+"/command/",d=null;"switchBinary"===a.get("deviceType")&&(d="off"===a.get("level")?"on":"off",Ember.$.getJSON(b+c+d).then(function(){a.set("level",d)}))}}}),Ember.TEMPLATES.application=Ember.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,Ember.Handlebars.helpers),e=e||{};var f,g="";return e.buffer.push('<div class="container-full">\n	<div class="container-outlet">\n		'),f=c._triageMustache.call(b,"outlet",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["ID"],data:e}),(f||0===f)&&e.buffer.push(f),e.buffer.push("\n	</div>\n</div>"),g}),Ember.TEMPLATES.switchBinary=Ember.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,Ember.Handlebars.helpers),e=e||{};var f,g="",h=this.escapeExpression;return e.buffer.push('<div class="panel panel-default">\n  	<div class="panel-heading">\n    	<h3 class="panel-title">'),f=c._triageMustache.call(b,"device.title",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["ID"],data:e}),(f||0===f)&&e.buffer.push(f),e.buffer.push('</h3>\n  	</div>\n  	<div class="panel-body">\n    	<button type="button" '),e.buffer.push(h(c["bind-attr"].call(b,{hash:{"class":":btn :btn-default device.binaryLevel:btn-primary"},hashTypes:{"class":"STRING"},hashContexts:{"class":b},contexts:[],types:[],data:e}))),e.buffer.push(" "),e.buffer.push(h(c.action.call(b,"setLevel","device",{hash:{},hashTypes:{},hashContexts:{},contexts:[b,b],types:["STRING","ID"],data:e}))),e.buffer.push(">"),f=c._triageMustache.call(b,"device.level",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["ID"],data:e}),(f||0===f)&&e.buffer.push(f),e.buffer.push("</button>\n  	</div>\n</div>"),g}),Ember.TEMPLATES.switchMultilevel=Ember.Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,Ember.Handlebars.helpers),e=e||{};var f,g="";return e.buffer.push('<div class="panel panel-default">\n  	<div class="panel-heading">\n    	<h3 class="panel-title">Multi - '),f=c._triageMustache.call(b,"device.title",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["ID"],data:e}),(f||0===f)&&e.buffer.push(f),e.buffer.push('</h3>\n  	</div>\n  	<div class="panel-body">\n    	'),f=c._triageMustache.call(b,"device.level",{hash:{},hashTypes:{},hashContexts:{},contexts:[b],types:["ID"],data:e}),(f||0===f)&&e.buffer.push(f),e.buffer.push("\n  	</div>\n</div>"),g}),Ember.TEMPLATES.index=Ember.Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return b.buffer.push("\n\n	"),d=c["if"].call(a,"device.isBinarySwitch",{hash:{},hashTypes:{},hashContexts:{},inverse:l.noop,fn:l.program(2,g,b),contexts:[a],types:["ID"],data:b}),(d||0===d)&&b.buffer.push(d),b.buffer.push("\n\n	"),d=c["if"].call(a,"device.isMultilevelSwitch",{hash:{},hashTypes:{},hashContexts:{},inverse:l.noop,fn:l.program(4,h,b),contexts:[a],types:["ID"],data:b}),(d||0===d)&&b.buffer.push(d),b.buffer.push("\n\n"),e}function g(a,b){var d,e,f="";return b.buffer.push("\n		"),b.buffer.push(k((d=c.render||a&&a.render,e={hash:{},hashTypes:{},hashContexts:{},contexts:[a,a],types:["STRING","ID"],data:b},d?d.call(a,"switchBinary","device",e):j.call(a,"render","switchBinary","device",e)))),b.buffer.push("\n	"),f}function h(a,b){var d,e,f="";return b.buffer.push("\n		"),b.buffer.push(k((d=c.render||a&&a.render,e={hash:{},hashTypes:{},hashContexts:{},contexts:[a,a],types:["STRING","ID"],data:b},d?d.call(a,"switchMultilevel","device",e):j.call(a,"render","switchMultilevel","device",e)))),b.buffer.push("\n	"),f}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,Ember.Handlebars.helpers),e=e||{};var i,j=c.helperMissing,k=this.escapeExpression,l=this;i=c.each.call(b,"device","in","App.devices",{hash:{itemController:"deviceItem"},hashTypes:{itemController:"STRING"},hashContexts:{itemController:b},inverse:l.noop,fn:l.program(1,f,e),contexts:[b,b,b],types:["ID","ID","ID"],data:e}),e.buffer.push(i||0===i?i:"")});